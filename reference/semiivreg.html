<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Semi-IV Regression Function — semiivreg • semiIVreg</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Semi-IV Regression Function — semiivreg"><meta name="description" content="Semi-IV regression function from Bruneel-Zupanc (2024).
Syntax inspired from ivreg. Returns MTE and MTR curves with confidence intervals.
Also returns coefficient of estimated ATE in case the treatment effect is homogenous.
The estimation is almost instantaneous (a few seconds at most).
By default, return analytic standard errors not accounting for the fact that the propensity score is estimated in semiivreg.
Use semiivreg_boot to obtain 'correct' bootstrapped confidence intervals (takes a bit longer)."><meta property="og:description" content="Semi-IV regression function from Bruneel-Zupanc (2024).
Syntax inspired from ivreg. Returns MTE and MTR curves with confidence intervals.
Also returns coefficient of estimated ATE in case the treatment effect is homogenous.
The estimation is almost instantaneous (a few seconds at most).
By default, return analytic standard errors not accounting for the fact that the propensity score is estimated in semiivreg.
Use semiivreg_boot to obtain 'correct' bootstrapped confidence intervals (takes a bit longer)."><meta property="og:image" content="https://cbruneelzupanc.github.io/semiIVreg/logo1.png"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@CBruneelZupanc"><meta name="twitter:site" content="@CBruneelZupanc"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">semiIVreg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/semiIVreg.html">Model and Guidelines</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-more" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">More</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-more"><li><a class="dropdown-item" href="../articles/semiIVreg_homogenousTE.html">Estimation with Homogenous Treatment Effect</a></li>
    <li><a class="dropdown-item" href="../articles/semiIVreg_heterogenousTE.html">Estimation with general Heterogenous Treatment Effect</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/CBruneelZupanc" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cbruneelzupanc/semiIVreg" aria-label="Github"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Semi-IV Regression Function</h1>

      <div class="d-none name"><code>semiivreg.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Semi-IV regression function from <a href="https://www.cbruneel.com/research" class="external-link">Bruneel-Zupanc (2024)</a>.
Syntax inspired from ivreg. Returns MTE and MTR curves with confidence intervals. <br>
Also returns coefficient of estimated ATE in case the treatment effect is homogenous. <br>
The estimation is almost <em>instantaneous</em> (a few seconds at most).</p>
<p>By default, return analytic standard errors not accounting for the fact that the propensity score is estimated in <code>semiivreg</code>.
Use <code>semiivreg_boot</code> to obtain 'correct' bootstrapped confidence intervals (takes a bit longer).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">semiivreg</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, propensity_formula<span class="op">=</span><span class="cn">NULL</span>, ref_indiv <span class="op">=</span><span class="cn">NULL</span>,</span>
<span>           firststage_model<span class="op">=</span><span class="st">"probit"</span>,</span>
<span>           pol_degree_transform <span class="op">=</span> <span class="fl">5</span>, conf_level <span class="op">=</span> <span class="fl">0.05</span>, common_supp_trim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>           trimming_value<span class="op">=</span><span class="cn">NULL</span>, automatic_trim<span class="op">=</span><span class="cn">FALSE</span>, plotting<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">semiivreg_boot</span><span class="op">(</span><span class="va">formula</span>, Nboot<span class="op">=</span><span class="fl">500</span>, <span class="va">data</span>, propensity_formula<span class="op">=</span><span class="cn">NULL</span>, ref_indiv <span class="op">=</span><span class="cn">NULL</span>,</span>
<span>               firststage_model<span class="op">=</span><span class="st">"probit"</span>,</span>
<span>               pol_degree_transform <span class="op">=</span> <span class="fl">5</span>, common_supp_trim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, trimming_value <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>               automatic_trim <span class="op">=</span> <span class="cn">FALSE</span>, plotting<span class="op">=</span><span class="cn">TRUE</span>, conf_level <span class="op">=</span> <span class="fl">0.05</span>, CI_method <span class="op">=</span> <span class="st">"delta"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>Formula of the regression, of the form outcome ~ treatment | semi-iv0 | semi-iv1 | commoncovariates. <br>
The treatment variable should be binary (0, 1). <br>
covariates with an effect that differs on D=1 and D=0 should be included in each semi-iv0 and semi-iv1.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Dataframe containing the data.</p></dd>


<dt id="arg-propensity-formula">propensity_formula<a class="anchor" aria-label="anchor" href="#arg-propensity-formula"></a></dt>
<dd><p>Formula for the 1st stage. If nothing specified, just runs a probit of d ~ semi-iv0 + semi-iv1 + covariates (removing the redundant variables).</p></dd>


<dt id="arg-ref-indiv">ref_indiv<a class="anchor" aria-label="anchor" href="#arg-ref-indiv"></a></dt>
<dd><p>Specify the reference individual (in terms of covariates) at which we will evaluate the function. <br>
by default takes the average value for the numerical covariates, and the reference level for factors. <br></p></dd>


<dt id="arg-firststage-model">firststage_model<a class="anchor" aria-label="anchor" href="#arg-firststage-model"></a></dt>
<dd><p>By default, the first stage is a probit model. Can specify another model (e.g., "logit").</p></dd>


<dt id="arg-pol-degree-transform">pol_degree_transform<a class="anchor" aria-label="anchor" href="#arg-pol-degree-transform"></a></dt>
<dd><p>Degree of the polynomial transformation for the control function.</p></dd>


<dt id="arg-conf-level">conf_level<a class="anchor" aria-label="anchor" href="#arg-conf-level"></a></dt>
<dd><p>Confidence level for the confidence intervals.</p></dd>


<dt id="arg-common-supp-trim">common_supp_trim<a class="anchor" aria-label="anchor" href="#arg-common-supp-trim"></a></dt>
<dd><p>Vector of two values indicating the set of propensity scores at which we will evaluate the function. <br>
Default is the full support <code>[0,1]</code>. But can be trimmed manually.</p></dd>


<dt id="arg-trimming-value">trimming_value<a class="anchor" aria-label="anchor" href="#arg-trimming-value"></a></dt>
<dd><p>Can either be a vector c(0.05, 0.95) indicating the quantile of the propensity score above which and below which we keep the observations for both D=0 and D=1. <br>
Can also be a single value, in which case symmetric trimming up and down. <br>
Inserting a trimming_value generates automatic_trim = TRUE automatically.</p></dd>


<dt id="arg-automatic-trim">automatic_trim<a class="anchor" aria-label="anchor" href="#arg-automatic-trim"></a></dt>
<dd><p>If TRUE, the estimation of the second stage is done on the common_support only.</p></dd>


<dt id="arg-plotting">plotting<a class="anchor" aria-label="anchor" href="#arg-plotting"></a></dt>
<dd><p>TRUE if wants to plot at the end of the function, FALSE otherwise.</p></dd>


<dt id="arg-nboot">Nboot<a class="anchor" aria-label="anchor" href="#arg-nboot"></a></dt>
<dd><p>Number of bootstrap samples.</p></dd>


<dt id="arg-ci-method">CI_method<a class="anchor" aria-label="anchor" href="#arg-ci-method"></a></dt>
<dd><p>"delta" for delta method, "curve" for bootstrap the MTE curves directly.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with the following elements:</p><dl><dt><code>$data</code></dt>
<dd><p>Returns data of output estimation used to plot the MTE and MTR. In details:</p><dl><dt><code>$RES</code></dt>
<dd><p>Dataframe with the estimated MTE and MTR values and their confidence intervals.</p></dd>

<dt><code>$RES_homogenous</code></dt>
<dd><p>Dataframe with the estimated MTE and MTR values and their confidence intervals for homogenous treatment effects.</p></dd>

<dt><code>$orig_data</code></dt>
<dd><p>Original data used for the estimation where we added the propensity score estimated, named <code>Phat</code>.</p></dd>

<dt><code>$ref_indiv</code></dt>
<dd><p>Reference individual(s) at which we evaluate the MTE and MTR.</p></dd>

<dt><code>$Xdat</code></dt>
<dd><p>Original covariates, just used for bootstrap function.</p></dd>


</dl></dd>


<dt><code>$estimate</code></dt>
<dd><p>Returns the estimation of:</p><dl><dt><code>$est</code></dt>
<dd><p>Second stage estimate of \(E[Y_d | D, W_d, X, \widehat{P}]\) where \(\widehat{P}\) is controlled for with a flexible control function (polynomial) \(\kappa_d(P)\).</p></dd>

<dt><code>$propensity</code></dt>
<dd><p>First stage estimate of the propensity score.</p></dd>

<dt><code>$est_homogenous</code></dt>
<dd><p>Homogenous TE Second stage estimate of \(E[Y_d | D, W_d, X, \widehat{P}]\) <br>
Homogenous TE implies restriction that \(\kappa_0(P) = -\kappa_1(P) \frac{P}{1-P}\) because \(E(U)=0\). <br>
which ensures \(k_0(u) = k_1(u)\), cf Bruneel-Zupanc (2024).</p></dd>

<dt><code>$homogenous_TE</code></dt>
<dd><p>Extract only the ATE estimation in case of homogenous treatment effects (can be observed in <code>est_homogenous</code> as well).</p></dd>


</dl></dd>


<dt><code>$plot</code></dt>
<dd><p>Returns separately the following plot objects: <code>supp</code>, <code>mtr</code>, <code>mte</code>, <code>mtr_homogenous</code>, <code>mte_homogenous</code>.</p></dd>

<dt><code>$supp</code></dt>
<dd><p>Returns the common support of the propensity score <code>Phat</code> between the two treatment group.</p></dd>

<dt><code>$call</code></dt>
<dd><p>Returns the call of the function.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="the-estimated-model">The estimated model<a class="anchor" aria-label="anchor" href="#the-estimated-model"></a></h2>
    <p><code>semiivreg</code> estimates the marginal treatment effect (MTE) and marginal treatment response (MTR) of the following model. <br></p>
<p>The potential outcomes are given by
$$
Y_0 = \delta_{0} + W_0 \beta_0 + X \beta^X_{0} + U_0,      \quad \quad \quad (1)
$$
$$
Y_1 = \delta_{1} + W_1 \beta_1 + X \beta^X_{1} + U_1,      \quad \quad \quad (2)
$$
with selection rule
$$
\begin{aligned}
D^* &amp;= g(W_0, W_1, X) - V \\
&amp;= - ( \alpha + \alpha_0 W_0 + \alpha_1 W_1 + \alpha_{X} X ) - V, \quad \quad \quad (3) \\
\text{ with } \quad D &amp;= \mathbb{I}(D^* &gt; 0),
\end{aligned}
$$
where</p><ul><li><p><b>semi-IVs.</b> \(W_0\) (respectively \(W_1\)) are the semi-IVs excluded from \(Y_1\) (resp. \(Y_0\)). Each \(W_0\) and \(W_1\) may contain several variables. Nonparametric identification requires that each \(W_d\) contains <em>at least one excluded variable</em> (see Bruneel-Zupanc, 2024).</p></li>
<li><p><b>Covariates.</b> \(X\) are the covariates that affect both potential outcomes.
One can restrict the effect of \(X\) to be the same across both potential outcomes (i.e., \(\beta^X_{0} = \beta^X_{1}\)). To do so, specify: <code>semiivreg(y~d|w0|w1|x, data)</code>.
In general, different effect of the covariates across alternatives (i.e., \(\beta^X_{0} \neq \beta^X_{1}\)). To be specified by including the covariates in the semi-IVs: <code>semiivreg(y~d|w0+x|w1+x, data)</code>.</p></li>
<li><p><b>Unobservables.</b> \(U_0\) and \(U_1\) are general unobservables (may include several shocks, some may be the same across alternatives) affecting the outcomes.
\(V\) is a scalar unobservable that affects the selection. The lower \(V\), the more likely one is to select into treatment.
Nonparametric identification requires <em>independence</em>, i.e., \((U_0, U_1, V) \perp (W_0, W_1) | X\).
For estimation here, we additionally assume additive <em>separability</em> of the covariates \(X\), i.e., that \(E(U_d | V, X) = E(U_d | V)\) for both \(d=0,1\).
This assumption is <em>not necessary</em> for the identification, nor for the estimation. But it is a standard <em>simplification</em> that helps the estimation.
See Carneiro, Heckman and Vytlacil (2011), Brinch, Mogstad and Wiswall (2017) or Andresen (2018) for comparable examples of the estimation of MTE with IVs. <br></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="estimation-procedure">Estimation Procedure<a class="anchor" aria-label="anchor" href="#estimation-procedure"></a></h2>
    <p>The estimation procedure follow closely the counterpart estimation of MTE with standard IVs, see for e.g., Andresen (2018).
The command estimates marginal treatment responses and marginal treatment effects, i.e.,
$$
\begin{aligned}
MTR_d(u, w_d, x) &amp;= E(Y_d | X=x, W_d=w_d, U_D=u), \\
MTE(u, x, w_0, w_1) &amp;= E(Y_1 - Y_0 | X = x, W_0=w_0, W_1=w_1, U_D=u) \\
&amp;= MTR_1(u, w_1, x) - MTR_0(u, w_0, x),
\end{aligned}
$$
where \(U_D = F_V(V) \sim \mathcal{U}(0, 1)\) is the normalized unobserved resistance to treatment. <br></p>
<p>The estimation proceeds in two stage.</p><ul><li><p><b>First stage.</b> Estimate the propensity score \(\widehat{P}\) of treatment selection of equation (3). <br>
By default, the function \(g(\cdot)\) is given by the simple linear specification above, but the code allows to specify any other first stage. For example:
</p><div class="sourceCode"><pre><code><span><span class="fu"><a href="../reference/semiivreg.html">semiivreg</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">d</span><span class="op">|</span><span class="va">w0</span><span class="op">+</span><span class="va">x</span><span class="op">|</span><span class="va">w1</span><span class="op">+</span><span class="va">x</span>, <span class="va">data</span>,</span>
<span>                        propensity_formula <span class="op">=</span> <span class="va">d</span><span class="op">~</span><span class="va">w0</span><span class="op">+</span><span class="va">w1</span><span class="op">+</span><span class="va">w0</span><span class="op">:</span><span class="va">w1</span><span class="op">+</span><span class="va">w0</span><span class="op">:</span><span class="va">x</span><span class="op">+</span><span class="va">w1</span><span class="op">:</span><span class="va">x</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">w0</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">w1</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
By default, the estimation assumes a <em>probit model</em> for the first stage (i.e., assumes \(V\) is normally distributed). But can specify otherwise (e.g., logit) with <code>firststage_model</code> command. In theory, could add any specification for the first stage, could even allow to estimate the propensity score outside of the semiivreg command (not implemented yet). <br></li>
<li><p><b>Second stage.</b> Estimate the control function \(\kappa_d(P)\) of the potential outcomes \(Y_d\) given the propensity score \(P\) and the covariates \(X\). The control function is estimated with a flexible polynomial transformation of the propensity score.
The estimation is done with a <em>stacked regression</em> of the potential outcomes specification (1)-(2):
$$ \begin{aligned} E[Y|W_0, W_1, X, \widehat{P}] = &amp;D \times ( \delta_{1} + W_1 \beta_1 + X \beta^X_{1} + \kappa_1(\widehat{P}) ) + \\
           &amp;(1-D) \times ( \delta_{0} + W_0 \beta_0 + X \beta^X_{0} + \kappa_0(\widehat{P})). \end{aligned}
 $$
where the control functions are sample estimate (using estimate \(\widehat{P}\)) of their theoretical counterpart:
$$\begin{aligned}
 \kappa_1(P) &amp;= E[ U_1 | D=1, W_1, W_0, X,P] = E[U_1|D=1, P] = E[U_1 | U_D \leq P] \\
 \kappa_0(P) &amp;= E[ U_0 | D=0, W_1, W_0, X,P] = E[U_0|D=0, P] = E[U_0 | U_D &gt; P]
 \end{aligned}$$
By default, we estimate flexible polynomials of degree <code>pol_degree_transform</code> for \(\kappa_0(P)\) and \(\kappa_1(P)\) . <br>About the semi-IVs and covariates, note that \(W_0\) and \(W_1\) can be flexible transformations (polynomial, splines) of specific variables, so the outcome equation are quite flexible (could also specify interactions between \(W_d\) and \(X\)). <br>Once equation the second stage is estimated, we don't need to estimate any other parameters, just to take the proper derivatives of the estimated functional form.
We have:
$$\begin{aligned}
 \widehat{k}_1(u) &amp;= E[ U_1 | U_D=u] = \widehat{\kappa}_1(u) + u \widehat{\kappa}_1'(u) \\
 \widehat{k}_0(u) &amp;= E[ U_0 | U_D=u] = \widehat{\kappa}_0(u) - (1-u) \widehat{\kappa}_0'(u),
 \end{aligned}$$
where the derivatives are easy to compute if \(\kappa\) is a polynomial function.  <br>Then, the <em>Marginal Treatment Responses</em> are given by:
$$
\begin{aligned}
\widehat{MTR}_d(u, w_d, x) &amp;= E(Y_d | X=x, W_d=w_d, U_D=u) = \widehat{\delta}_{d} + w_d \widehat{\beta}_d + x \widehat{\beta}^X_{d} + \widehat{k}_d(u),
\end{aligned}
$$and the <em>Marginal Treatment Effects</em> are
$$
\begin{aligned}
\widehat{MTE}(u, x, w_0, w_1) = \widehat{MTR}_1(u, w_1, x) - \widehat{MTR}_0(u, w_0, x).
\end{aligned}
$$</p></li>
</ul><div class="section">
<h3 id="special-case-with-homogenous-treatment-effects">Special case with Homogenous Treatment Effects<a class="anchor" aria-label="anchor" href="#special-case-with-homogenous-treatment-effects"></a></h3>


<p>The <em>homogenous treatment effects</em> estimates correspond to the same potential outcome model (1)-(2), with \(U_0 = U_1 = U\). <br></p>
<p>This leads to known restrictions on the control functions \(\kappa_0(P)\) and \(\kappa_1(P)\) that we impose in the stacked second stage regression. Indeed,
$$
E(U) = 0 = E(U | U_D \leq P) P + E(U | U_D &gt; P) (1-P)
$$
So, \(\kappa_0(P) = -\kappa_1(P) \frac{P}{1-P}\), and one can check that it yields \(k_0(u) = k_1(u) = k(u)\). <br></p>
<p>Thus, the MTE is constant (\(k_1(u) - k_0(u) = 0\), it cancels out), and equal to:
$$
\widehat{MTE}(x, w_0, w_1) = \widehat{\delta}_{1} - \widehat{\delta}_{0} + w_1 \widehat{\beta}_1 - w_0 \widehat{\beta}_0 + x (\widehat{\beta}^X_{1} - \widehat{\beta}^X_{0}).
$$
The MTR still varies with \(u\) because \(k(u)\) is not constant, and we also estimate it. <br></p>
</div>

    </div>
    <div class="section level2">
    <h2 id="caution-about-the-estimated-standard-errors">Caution about the Estimated Standard errors<a class="anchor" aria-label="anchor" href="#caution-about-the-estimated-standard-errors"></a></h2>
    <p>By default, return <b>analytic standard errors</b> <em>not accounting for the fact that the propensity score is estimated</em> in <code>semiivreg</code>.
Use <code>semiivreg_boot</code> to obtain 'correct' bootstrapped confidence intervals.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Bruneel-Zupanc, C. (2024). Don't (fully) exclude me, it's not necessary! Identification with semi-IVs. arXiv preprint arXiv:2303.12667. <br></p>
<p>For empirical applications of the estimation of Marginal Treatment Effects with standard IVs, see for example: <br>
Carneiro, P., Heckman, J. J., &amp; Vytlacil, E. J. (2011). Estimating marginal returns to education. American Economic Review, 101(6), 2754-2781. <br></p>
<p>Brinch, C. N., Mogstad, M., &amp; Wiswall, M. (2017). Beyond LATE with a discrete instrument. Journal of Political Economy, 125(4), 985-1039. <br></p>
<p>In particular, see Andresen, M. E. (2018). Exploring marginal treatment effects: Flexible estimation using Stata. The Stata Journal, 18(1), 118-158.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Christophe Bruneel-Zupanc, <a href="cbruneel.com">cbruneel.com</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Load data:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">roydata</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run the semi-IV regression</span></span></span>
<span class="r-in"><span><span class="va">semiiv</span> <span class="op">=</span> <span class="fu">semiivreg</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">d</span><span class="op">|</span><span class="va">w0</span><span class="op">|</span><span class="va">w1</span>, data<span class="op">=</span><span class="va">roydata</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="semiivreg-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">semiiv</span> <span class="op">=</span> <span class="fu">semiivreg</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">d</span><span class="op">|</span><span class="va">w0</span><span class="op">|</span><span class="va">w1</span><span class="op">|</span><span class="va">Xbinary</span> <span class="op">+</span> <span class="va">Xcontinuous</span>, data<span class="op">=</span><span class="va">roydata</span><span class="op">)</span> <span class="co"># with covariates</span></span></span>
<span class="r-plt img"><img src="semiivreg-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">semiiv</span> <span class="op">=</span> <span class="fu">semiivreg</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">d</span><span class="op">|</span><span class="va">w0</span><span class="op">+</span><span class="va">Xbinary</span><span class="op">|</span><span class="va">w1</span><span class="op">+</span><span class="va">Xbinary</span><span class="op">|</span><span class="va">Xcontinuous</span>, data<span class="op">=</span><span class="va">roydata</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="semiivreg-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># Xbinary has different effect on Y0 and Y1, Xcontinuous has the same.</span></span></span>
<span class="r-in"><span><span class="va">semiiv</span> <span class="op">=</span> <span class="fu">semiivreg</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">d</span><span class="op">|</span><span class="va">w0</span><span class="op">|</span><span class="va">w1</span>, data<span class="op">=</span><span class="va">roydata</span>, propensity_formula <span class="op">=</span> <span class="va">d</span><span class="op">~</span><span class="va">w0</span><span class="op">+</span><span class="va">w1</span><span class="op">+</span><span class="va">w0</span><span class="op">:</span><span class="va">w1</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="semiivreg-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># if want to specify another first stage</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">semiiv</span><span class="op">$</span><span class="va">plot</span><span class="op">$</span><span class="va">mtr</span> <span class="co"># if want to plot mtr_plot</span></span></span>
<span class="r-plt img"><img src="semiivreg-5.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christophe Bruneel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

