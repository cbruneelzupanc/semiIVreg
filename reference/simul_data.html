<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Simulate data from the Generalized Roy Model with semi-IVs — simul_data • semiIVreg</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate data from the Generalized Roy Model with semi-IVs — simul_data"><meta name="description" content="This function simulates data from the Generalized Roy Model with semi-IVs.
This is the simulation specified in Bruneel-Zupanc (2024). "><meta property="og:description" content="This function simulates data from the Generalized Roy Model with semi-IVs.
This is the simulation specified in Bruneel-Zupanc (2024). "></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">semiIVreg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/semiIVreg.html">Model and Guidelines</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-more" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">More</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-more"><li><a class="dropdown-item" href="../articles/semiIVreg_homogenousTE.html">Estimation with Homogenous Treatment Effect</a></li>
    <li><a class="dropdown-item" href="../articles/semiIVreg_heterogenousTE.html">Estimation with general Heterogenous Treatment Effect</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulate data from the Generalized Roy Model with semi-IVs</h1>

      <div class="d-none name"><code>simul_data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function simulates data from the Generalized Roy Model with semi-IVs. <br>
This is the simulation specified in Bruneel-Zupanc (2024). <br></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">simul_data</span><span class="op">(</span><span class="va">N</span>, model_type<span class="op">=</span><span class="st">"heterogenous"</span>,</span>
<span>           <span class="va">param_y0</span>, <span class="va">param_y1</span>, <span class="va">param_p</span>, <span class="va">param_Z</span>, <span class="va">param_genX</span>, <span class="va">param_error</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-n">N<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>Number of observations</p></dd>


<dt id="arg-model-type">model_type<a class="anchor" aria-label="anchor" href="#arg-model-type"></a></dt>
<dd><p>Type of model: "heterogenous" or "homogenous"</p></dd>


<dt id="arg-param-y-">param_y0<a class="anchor" aria-label="anchor" href="#arg-param-y-"></a></dt>
<dd><p>Parameters for Y0 = \((\delta_0, \beta_0, \beta_{0X_1}, \beta_{0X_2})\). <br>
i.e., intercept, effects on w0, \(X_1\), \(X_2\) on \(Y_0\).</p></dd>


<dt id="arg-param-y-">param_y1<a class="anchor" aria-label="anchor" href="#arg-param-y-"></a></dt>
<dd><p>Parameters for Y1: \((\delta_1, \beta_1, \beta_{1X_1}, \beta_{1X_2})\). <br>
i.e., intercept, effects w1, \(X_1\), \(X_2\) on \(Y_1\).</p></dd>


<dt id="arg-param-p">param_p<a class="anchor" aria-label="anchor" href="#arg-param-p"></a></dt>
<dd><p>Parameters for the selection: \((\alpha, \alpha_0, \alpha_1, \alpha_2, \alpha_{X_1}, \alpha_{X_2})\) <br>
i.e., intercept and effects of w0, w1, w0w1, Xbinary, Xcontinuous on the latent utility.</p></dd>


<dt id="arg-param-z">param_Z<a class="anchor" aria-label="anchor" href="#arg-param-z"></a></dt>
<dd><p>Parameters for the simulation of the semi-IVs: <br>
\((\mu_{W0,x_1=0}, \mu_{W1,x_1=0}, \mu_{W0,x_1=1}, \mu_{W1,x_1=1}, \sigma^2_{W0}, \sigma^2_{W1}, \sigma_{W0W1})\).</p></dd>


<dt id="arg-param-genx">param_genX<a class="anchor" aria-label="anchor" href="#arg-param-genx"></a></dt>
<dd><p>Parameters for the covariates: \((p_{X_1}, \mu_{X_2}, \sigma^2_{X_2})\).</p></dd>


<dt id="arg-param-error">param_error<a class="anchor" aria-label="anchor" href="#arg-param-error"></a></dt>
<dd><p>Parameters for the error terms: depends on model_type: <br>
if heterogenous: \((\sigma^2_{U0}, \sigma^2_{U1}, \sigma_{U0U1}, \sigma^2_{\text{cost}})\) <br>
if homogenous: \((\sigma^2_{U}, \sigma^2_{V}, \sigma_{UV})\)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame with the following columns:</p><dl><dt>y</dt>
<dd><p>The observed outcome.</p></dd>

<dt>d</dt>
<dd><p>The treatment.</p></dd>

<dt>w0, w1</dt>
<dd><p>The semi-IVs entering only D=0 and D=1.</p></dd>

<dt>Xbinary, Xcontinuous</dt>
<dd><p>Two covariates, one binary and one continuous.</p></dd>

<dt>y0, y1</dt>
<dd><p>The unobserved potential outcomes.</p></dd>

<dt>P</dt>
<dd><p>The unobserved true treatment probability.</p></dd>

<dt>latent, V, Ud, U0, U1</dt>
<dd><p>The unobserved shocks V. Ud is the normalized V ranks. U0 and U1 are the outcome shocks. <code>latent</code> gives the latent utility term in the selection equation.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="the-generalized-roy-model-">The Generalized Roy model.<a class="anchor" aria-label="anchor" href="#the-generalized-roy-model-"></a></h2>
    <p>This function simulates a generalized Roy model as described in Bruneel-Zupanc (2024). <br></p>
<p><b>Potential Outcomes.</b> The potential outcomes (e.g., earnings) are given by:
$$
Y_0 = \delta_{0} + \beta_{0} W_0 + X \beta_{0X} + U_0,
$$
$$
Y_1 = \delta_{1} + \beta_{1} W_1 + X \beta_{1X} + U_1,
$$
where \(W_0, W_1\) are the observed <b>semi-IVs</b> excluded from \(Y_1\) and \(Y_0\) respectively, \(X=(X_1, X_2)\) is a vector of a binary (\(X_1\), e.g., location) and a continuous (\(X_2\), e.g., education of the parents) observable <b>covariates</b>,
and \(U_0, U_1\) are unobservable errors. <br></p>
<p><b>Selection problem.</b> We only observe the outcome
$$
Y = (1-D) Y_0 + D Y_1.
$$
where \(D\) represents the (binary) treatment decision (e.g., education choice), given by the following selection rule:
$$
\begin{aligned}
D^* &amp;= g(W_0, W_1, X) - V \\
&amp;= - ( \alpha + \alpha_0 W_0 + \alpha_1 W_1 + \alpha_2 W_0 \times W_1 + \alpha_{X_1} X_1 + \alpha_{X_2} X_2) - V, \\
\text{ with } \quad D &amp;= \mathbb{I}(D^* &gt; 0),
\end{aligned}
$$
where \(V\) is the main unobservable probability shock, and the higher \(V\), the more likely one is to be treated.
Note that we <em>normalize</em> \(U_D=F_{V}(V)\) to get the normalized probability shock \(U_D \sim \mathcal{U}(0, 1)\).
\(U_D\) can be interpreted as unobserved resistance to treatment,
The closer \(U_D\) is to 0, the more likely the individual is to be treated.</p>
<p>This specification yields that the probability of treatment is given by:
$$ \textrm{Pr}(D=1 | W_0, W_1, X) = \textrm{Pr}(V &lt; g(W_0, W_1, X)). $$
Thus, ceteris paribus, the lower \(g\), the higher the probability of treatment. <br></p>
<p><b>Unobservables specification.</b> The specification of the unobservable depends on the model type. <br></p>
<p>For the general <b>heterogenous treatment effect model</b>, we have:
#' $$
\begin{pmatrix}
U_0 \\
U_1
\end{pmatrix}
\sim \mathcal{N}\left(
\begin{pmatrix}
0 \\
0
\end{pmatrix},
\begin{pmatrix}
\sigma^2_{U0} &amp; \sigma_{U0U1} \\
\sigma_{U0U1} &amp; \sigma^2_{U1}
\end{pmatrix}
\right),
$$
$$
C \sim \mathcal{N}(\mu_{\text{cost}}, \sigma^2_{\text{cost}}),
$$
$$
V = -(U_1 - U_0 - C).
$$</p>
<p>For the <b>homogeneous treatment effect</b> model:
$$
\begin{pmatrix}
U \\
V
\end{pmatrix}
\sim \mathcal{N}\left(
\begin{pmatrix}
0 \\
\mu_{V}
\end{pmatrix},
\begin{pmatrix}
\sigma^2_{U} &amp; \sigma_{UV} \\
\sigma_{UV} &amp; \sigma^2_{V}
\end{pmatrix}
\right),
$$
$$
U_0 = U_1 = U.
$$</p>
<p>In both cases, \(V\) is normally distributed, such that the selection equation is a probit model. <br></p>
<p><b>Covariates and semi-IVs specification.</b>
The covariates are generated by
$$ X_1 \sim \text{Bernoulli}(p_{X_1}) \text{ and } X_1 \sim \mathcal{N}(\mu_{X_2}, \sigma^2_{X_2}). $$</p>
<p>The semi-IVs are \(X_1\)-specific and are given by:
$$
\begin{pmatrix}
W_0 \\
W_1
\end{pmatrix}
\sim \mathcal{N}\left(
\begin{pmatrix}
\mu_{W0,x_1} \\
\mu_{W1,x_1}
\end{pmatrix},
\begin{pmatrix}
\sigma^2_{W0} &amp; \sigma_{W0W1} \\
\sigma_{W0W1} &amp; \sigma^2_{W1}
\end{pmatrix}
\right),
$$
where the means \(\mu_{W0,x_1}\) and \(\mu_{W1,x_1}\) depend on the binary covariate \(X_1=x_1\). <br></p>
    </div>
    <div class="section level2">
    <h2 id="simulating-standard-iv-mte-models-">Simulating standard IV MTE models.<a class="anchor" aria-label="anchor" href="#simulating-standard-iv-mte-models-"></a></h2>
    <p>This function can be used to model problem with IVs used to estimate Marginal Treatment Effects, by setting the effect of the semi-IVs on their respective outcomes to zero.
The coefficients can be adjusted to mimic the Roy models of Heckman, Urzua and Vytlacil (2006), or Heckman and Vytlacil (2007).
Small adjustments inside the function allow to mimic the simulation of Andresen (2018) (mtefe in Stata), but with only 2 regions (state).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Bruneel-Zupanc, C. (2023). Don't (fully) exclude me, it's not necessary! Identification with semi-IVs. arXiv preprint arXiv:2303.12667.</p>
<p>Andresen, M. E. (2018). Exploring marginal treatment effects: Flexible estimation using Stata. The Stata Journal, 18(1), 118-158.</p>
<p>Heckman, J. J., Urzua, S., &amp; Vytlacil, E. (2006). Understanding instrumental variables in models with essential heterogeneity. The Review of Economics and Statistics, 88(3), 389-432.</p>
<p>Heckman, J. J., &amp; Vytlacil, E. J. (2007). Econometric evaluation of social programs, part II: Using the marginal treatment effect to organize alternative econometric estimators to evaluate social programs, and to forecast their effects in new environments. Handbook of econometrics, 6, 4875-5143.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">N</span> <span class="op">=</span> <span class="fl">10000</span>; <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 1: Heterogenous Treatment Effects.</span></span></span>
<span class="r-in"><span><span class="va">model_type</span> <span class="op">=</span> <span class="st">"heterogenous"</span></span></span>
<span class="r-in"><span><span class="va">param_error</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0.6</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="co"># var_u0, var_u1, cov_u0u1, var_cost</span></span></span>
<span class="r-in"><span><span class="va">param_Z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="fl">0.9</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># meanW0 Xbinary0, meanW1 Xbinary0, meanW0 Xbinary1, meanW1 Xbinary1, varW0, varW1, covW0W1</span></span></span>
<span class="r-in"><span><span class="va">param_p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="co"># constant, W0, W1, W0xW1, Xbinary, Xcontinuous</span></span></span>
<span class="r-in"><span><span class="va">param_y0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.2</span>, <span class="fl">0.8</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="co"># intercept, W0, Xbinary, Xcontinuous;</span></span></span>
<span class="r-in"><span><span class="va">param_y1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.2</span><span class="op">+</span><span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="co"># the +0.4 = ATE; W1, Xbinary, Xcontinuous;</span></span></span>
<span class="r-in"><span><span class="va">param_genX</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">=</span> <span class="fu">simul_data</span><span class="op">(</span><span class="va">N</span>, <span class="va">model_type</span>, <span class="va">param_y0</span>, <span class="va">param_y1</span>, <span class="va">param_p</span>, <span class="va">param_Z</span>, <span class="va">param_genX</span>, <span class="va">param_error</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 2: Homogenous Treatment Effects (constant MTE)</span></span></span>
<span class="r-in"><span><span class="va">model_type</span> <span class="op">=</span> <span class="st">"homogenous"</span></span></span>
<span class="r-in"><span><span class="va">param_error</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="op">-</span><span class="fl">0.6</span><span class="op">)</span> <span class="co"># var_u, var_v, cov_uv</span></span></span>
<span class="r-in"><span><span class="va">param_Z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="fl">0.9</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">param_p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="co"># the constant &lt;=&gt; mean_V</span></span></span>
<span class="r-in"><span><span class="va">param_y0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.2</span>, <span class="fl">0.8</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">param_y1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3.2</span><span class="op">+</span><span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">param_genX</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">data1</span> <span class="op">=</span> <span class="fu">simul_data</span><span class="op">(</span><span class="va">N</span>, <span class="va">model_type</span>, <span class="va">param_y0</span>, <span class="va">param_y1</span>, <span class="va">param_p</span>, <span class="va">param_Z</span>, <span class="va">param_genX</span>, <span class="va">param_error</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set the effects of w1 or w0 on its outcome to zero if want a valid IV, e.g.,</span></span></span>
<span class="r-in"><span><span class="co"># param_y1 = c(3.2+0.4, 0, 0, 0) # w1 is a valid IV</span></span></span>
<span class="r-in"><span><span class="co"># or: param_y0 = c(3.2, 0, 0, 0) # w0 is a valid IV</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christophe Bruneel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

